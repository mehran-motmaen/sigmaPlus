<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">CobaltStrike Named Pipe</title><id type="str">d5601f8c-b26f-4ab0-9035-69e11a8d4ad2</id><status type="str">test</status><description type="str">Detects the creation of a named pipe as used by CobaltStrike</description><references type="list"><item type="str">https://twitter.com/d4rksystem/status/1357010969264873472</item><item type="str">https://labs.f-secure.com/blog/detecting-cobalt-strike-default-modules-via-named-pipe-analysis/</item><item type="str">https://github.com/SigmaHQ/sigma/issues/253</item><item type="str">https://blog.cobaltstrike.com/2021/02/09/learn-pipe-fitting-for-all-of-your-offense-projects/</item><item type="str">https://redcanary.com/threat-detection-report/threats/cobalt-strike/</item></references><author type="str">Florian Roth (Nextron Systems), Wojciech Lesicki</author><date type="str">2021/05/25</date><modified type="str">2022/10/31</modified><tags type="list"><item type="str">attack.defense_evasion</item><item type="str">attack.privilege_escalation</item><item type="str">attack.t1055</item></tags><logsource type="dict"><product type="str">windows</product><category type="str">pipe_created</category><definition type="str">Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can always use Cobalt Strike, but also you can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575</definition></logsource><detection type="dict"><selection_MSSE type="dict"><key name="PipeName|contains|all" type="list"><item type="str">\MSSE-</item><item type="str">-server</item></key></selection_MSSE><selection_postex type="dict"><key name="PipeName|startswith" type="str">\postex_</key></selection_postex><selection_status type="dict"><key name="PipeName|startswith" type="str">\status_</key></selection_status><selection_msagent type="dict"><key name="PipeName|startswith" type="str">\msagent_</key></selection_msagent><selection_mojo type="dict"><key name="PipeName|startswith" type="str">\mojo_</key></selection_mojo><selection_interprocess type="dict"><key name="PipeName|startswith" type="str">\interprocess_</key></selection_interprocess><selection_samr type="dict"><key name="PipeName|startswith" type="str">\samr_</key></selection_samr><selection_netlogon type="dict"><key name="PipeName|startswith" type="str">\netlogon_</key></selection_netlogon><selection_srvsvc type="dict"><key name="PipeName|startswith" type="str">\srvsvc_</key></selection_srvsvc><selection_lsarpc type="dict"><key name="PipeName|startswith" type="str">\lsarpc_</key></selection_lsarpc><selection_wkssvc type="dict"><key name="PipeName|startswith" type="str">\wkssvc_</key></selection_wkssvc><condition type="str">1 of selection*</condition></detection><falsepositives type="list"><item type="str">Unknown</item></falsepositives><level type="str">critical</level></root>