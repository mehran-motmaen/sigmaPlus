<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Potential Credential Dumping Attempt Using New NetworkProvider - REG</title><id type="str">0442defa-b4a2-41c9-ae2c-ea7042fc4701</id><related type="list"><item type="dict"><id type="str">baef1ec6-2ca9-47a3-97cc-4cf2bda10b77</id><type type="str">similar</type></item></related><status type="str">experimental</status><description type="str">Detects when an attacker tries to add a new network provider in order to dump clear text credentials, similar to how the NPPSpy tool does it</description><references type="list"><item type="str">https://docs.microsoft.com/en-us/troubleshoot/windows-client/deployment/network-provider-settings-removed-in-place-upgrade</item><item type="str">https://github.com/gtworek/PSBits/tree/master/PasswordStealing/NPPSpy</item></references><author type="str">Nasreddine Bencherchali (Nextron Systems)</author><date type="str">2022/08/23</date><modified type="str">2023/02/02</modified><tags type="list"><item type="str">attack.credential_access</item><item type="str">attack.t1003</item></tags><logsource type="dict"><category type="str">registry_set</category><product type="str">windows</product></logsource><detection type="dict"><selection type="dict"><EventType type="str">SetValue</EventType><key name="TargetObject|contains|all" type="list"><item type="str">\System\CurrentControlSet\Services\</item><item type="str">\NetworkProvider</item></key></selection><filter type="dict"><key name="TargetObject|contains" type="list"><item type="str">\System\CurrentControlSet\Services\WebClient\NetworkProvider</item><item type="str">\System\CurrentControlSet\Services\LanmanWorkstation\NetworkProvider</item><item type="str">\System\CurrentControlSet\Services\RDPNP\NetworkProvider</item></key></filter><filter_valid_procs type="dict"><Image type="str">C:\Windows\System32\poqexec.exe</Image></filter_valid_procs><condition type="str">selection and not 1 of filter*</condition></detection><falsepositives type="list"><item type="str">Other legitimate network providers used and not filtred in this rule</item></falsepositives><level type="str">medium</level></root>