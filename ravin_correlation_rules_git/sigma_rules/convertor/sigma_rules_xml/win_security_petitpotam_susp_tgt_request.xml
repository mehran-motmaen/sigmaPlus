<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">PetitPotam Suspicious Kerberos TGT Request</title><id type="str">6a53d871-682d-40b6-83e0-b7c1a6c4e3a5</id><status type="str">experimental</status><description type="str">Detect suspicious Kerberos TGT requests.
Once an attacer obtains a computer certificate by abusing Active Directory Certificate Services in combination with PetitPotam, the next step would be to leverage the certificate for malicious purposes.
One way of doing this is to request a Kerberos Ticket Granting Ticket using a tool like Rubeus.
This request will generate a 4768 event with some unusual fields depending on the environment.
This analytic will require tuning, we recommend filtering Account_Name to the Domain Controller computer accounts.
</description><references type="list"><item type="str">https://github.com/topotam/PetitPotam</item><item type="str">https://isc.sans.edu/forums/diary/Active+Directory+Certificate+Services+ADCS+PKI+domain+admin+vulnerability/27668/</item><item type="str">https://github.com/splunk/security_content/blob/develop/detections/endpoint/petitpotam_suspicious_kerberos_tgt_request.yml</item></references><author type="str">Mauricio Velazco, Michael Haag</author><date type="str">2021/09/02</date><modified type="str">2022/10/05</modified><tags type="list"><item type="str">attack.credential_access</item><item type="str">attack.t1187</item></tags><logsource type="dict"><product type="str">windows</product><service type="str">security</service><definition type="str">The advanced audit policy setting &quot;Account Logon &gt; Kerberos Authentication Service&quot; must be configured for Success/Failure</definition></logsource><detection type="dict"><selection type="dict"><EventID type="int">4768</EventID><key name="TargetUserName|endswith" type="str">$</key><key name="CertThumbprint|contains" type="str">*</key></selection><filter_local type="dict"><IpAddress type="str">::1</IpAddress></filter_local><filter_thumbprint type="dict"><CertThumbprint type="str"></CertThumbprint></filter_thumbprint><condition type="str">selection and not 1 of filter_*</condition></detection><falsepositives type="list"><item type="str">False positives are possible if the environment is using certificates for authentication. We recommend filtering Account_Name to the Domain Controller computer accounts.</item></falsepositives><level type="str">high</level></root>