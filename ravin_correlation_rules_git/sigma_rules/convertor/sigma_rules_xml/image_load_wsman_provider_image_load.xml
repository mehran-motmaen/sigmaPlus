<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Suspicious WSMAN Provider Image Loads</title><id type="str">ad1f4bb9-8dfb-4765-adb6-2a7cfb6c0f94</id><status type="str">experimental</status><description type="str">Detects signs of potential use of the WSMAN provider from uncommon processes locally and remote execution.</description><references type="list"><item type="str">https://twitter.com/chadtilbury/status/1275851297770610688</item><item type="str">https://bohops.com/2020/05/12/ws-management-com-another-approach-for-winrm-lateral-movement/</item><item type="str">https://docs.microsoft.com/en-us/windows/win32/winrm/windows-remote-management-architecture</item><item type="str">https://github.com/bohops/WSMan-WinRM</item></references><author type="str">Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)</author><date type="str">2020/06/24</date><modified type="str">2022/10/07</modified><tags type="list"><item type="str">attack.execution</item><item type="str">attack.t1059.001</item><item type="str">attack.lateral_movement</item><item type="str">attack.t1021.003</item></tags><logsource type="dict"><category type="str">image_load</category><product type="str">windows</product></logsource><detection type="dict"><request_client type="list"><item type="dict"><key name="ImageLoaded|endswith" type="list"><item type="str">\WsmSvc.dll</item><item type="str">\WsmAuto.dll</item><item type="str">\Microsoft.WSMan.Management.ni.dll</item></key></item><item type="dict"><OriginalFileName type="list"><item type="str">WsmSvc.dll</item><item type="str">WSMANAUTOMATION.DLL</item><item type="str">Microsoft.WSMan.Management.dll</item></OriginalFileName></item></request_client><respond_server type="dict"><key name="Image|endswith" type="str">\svchost.exe</key><OriginalFileName type="str">WsmWmiPl.dll</OriginalFileName></respond_server><filter_general type="dict"><key name="Image|endswith" type="list"><item type="str">\powershell.exe</item><item type="str">C:\Windows\System32\sdiagnhost.exe</item><item type="str">C:\Windows\System32\services.exe</item></key></filter_general><filter_svchost type="dict"><key name="CommandLine|contains" type="list"><item type="str">svchost.exe -k netsvcs -p -s BITS</item><item type="str">svchost.exe -k GraphicsPerfSvcGroup -s GraphicsPerfSvc</item><item type="str">svchost.exe -k NetworkService -p -s Wecsvc</item><item type="str">svchost.exe -k netsvcs</item></key></filter_svchost><filter_mscorsvw type="dict"><key name="Image|startswith" type="list"><item type="str">C:\Windows\Microsoft.NET\Framework64\v</item><item type="str">C:\Windows\Microsoft.NET\Framework\v</item></key><key name="Image|endswith" type="str">\mscorsvw.exe</key></filter_mscorsvw><filter_svr_2019 type="dict"><Image type="list"><item type="str">C:\Windows\System32\Configure-SMRemoting.exe</item><item type="str">C:\Windows\System32\ServerManager.exe</item></Image></filter_svr_2019><filter_nextron type="dict"><key name="Image|startswith" type="str">C:\Windows\Temp\asgard2-agent\</key></filter_nextron><filter_citrix type="dict"><key name="Image|startswith" type="str">C:\Program Files\Citrix\</key></filter_citrix><filter_ps_ise type="dict"><key name="Image|endswith" type="str">\powershell_ise.exe</key></filter_ps_ise><filter_upgrade type="dict"><key name="Image|startswith" type="str">C:\$WINDOWS.~BT\Sources\</key></filter_upgrade><svchost type="dict"><key name="Image|endswith" type="str">\svchost.exe</key></svchost><commandline_null type="dict"><CommandLine type="null"></CommandLine></commandline_null><condition type="str">( request_client or respond_server ) and not 1 of filter* and not ( svchost and commandline_null )</condition></detection><falsepositives type="list"><item type="str">Unknown</item></falsepositives><level type="str">medium</level></root>