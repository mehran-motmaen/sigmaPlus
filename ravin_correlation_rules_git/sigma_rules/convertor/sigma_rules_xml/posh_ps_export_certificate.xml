<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Certificate Exported Via PowerShell - ScriptBlock</title><id type="str">aa7a3fce-bef5-4311-9cc1-5f04bb8c308c</id><related type="list"><item type="dict"><id type="str">9e716b33-63b2-46da-86a4-bd3c3b9b5dfb</id><type type="str">similar</type></item></related><status type="str">test</status><description type="str">Detects calls to cmdlets inside of PowerShell scripts that are used to export certificates from the local certificate store. Threat actors were seen abusing this to steal private keys from compromised machines.</description><references type="list"><item type="str">https://us-cert.cisa.gov/ncas/analysis-reports/ar21-112a</item><item type="str">https://docs.microsoft.com/en-us/powershell/module/pki/export-pfxcertificate</item><item type="str">https://www.splunk.com/en_us/blog/security/breaking-the-chain-defending-against-certificate-services-abuse.html</item></references><author type="str">Florian Roth (Nextron Systems)</author><date type="str">2021/04/23</date><modified type="str">2023/05/18</modified><tags type="list"><item type="str">attack.credential_access</item><item type="str">attack.t1552.004</item></tags><logsource type="dict"><product type="str">windows</product><category type="str">ps_script</category><definition type="str">Requirements: Script Block Logging must be enabled</definition></logsource><detection type="dict"><selection type="dict"><key name="ScriptBlockText|contains" type="list"><item type="str">Export-PfxCertificate</item><item type="str">Export-Certificate</item></key></selection><filter_optional_module_export type="dict"><key name="ScriptBlockText|contains" type="str">CmdletsToExport = @(</key></filter_optional_module_export><condition type="str">selection and not 1 of filter_optional_*</condition></detection><falsepositives type="list"><item type="str">Legitimate certificate exports by administrators. Additional filters might be required.</item></falsepositives><level type="str">medium</level></root>