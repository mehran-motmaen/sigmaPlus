<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Malicious PowerShell Commandlets - ScriptBlock</title><id type="str">89819aa4-bbd6-46bc-88ec-c7f7fe30efa6</id><related type="list"><item type="dict"><id type="str">7d0d0329-0ef1-4e84-a9f5-49500f9d7c6c</id><type type="str">similar</type></item><item type="dict"><id type="str">02030f2f-6199-49ec-b258-ea71b07e03dc</id><type type="str">similar</type></item><item type="dict"><id type="str">6d3f1399-a81c-4409-aff3-1ecfe9330baf</id><type type="str">obsoletes</type></item><item type="dict"><id type="str">83083ac6-1816-4e76-97d7-59af9a9ae46e</id><type type="str">obsoletes</type></item></related><status type="str">test</status><description type="str">Detects Commandlet names from well-known PowerShell exploitation frameworks</description><references type="list"><item type="str">https://adsecurity.org/?p=2921</item><item type="str">https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries</item><item type="str">https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1</item><item type="str">https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1</item><item type="str">https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1</item><item type="str">https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1</item><item type="str">https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/</item><item type="str">https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/</item><item type="str">https://github.com/calebstewart/CVE-2021-1675</item><item type="str">https://github.com/BloodHoundAD/BloodHound/blob/0927441f67161cc6dc08a53c63ceb8e333f55874/Collectors/AzureHound.ps1</item><item type="str">https://bloodhound.readthedocs.io/en/latest/data-collection/azurehound.html</item><item type="str">https://github.com/HarmJ0y/DAMP</item><item type="str">https://github.com/samratashok/nishang</item><item type="str">https://github.com/DarkCoderSc/PowerRunAsSystem/</item><item type="str">https://github.com/besimorhino/powercat</item><item type="str">https://github.com/Kevin-Robertson/Powermad</item><item type="str">https://github.com/adrecon/ADRecon</item><item type="str">https://github.com/adrecon/AzureADRecon</item></references><author type="str">Sean Metcalf, Florian Roth, Bartlomiej Czyz @bczyz1, oscd.community, Nasreddine Bencherchali, Tim Shelton, Mustafa Kaan Demir, Georg Lauenstein, Max Altgelt, Tobias Michalski, Austin Songer</author><date type="str">2017/03/05</date><modified type="str">2023/04/17</modified><tags type="list"><item type="str">attack.execution</item><item type="str">attack.discovery</item><item type="str">attack.t1482</item><item type="str">attack.t1087</item><item type="str">attack.t1087.001</item><item type="str">attack.t1087.002</item><item type="str">attack.t1069.001</item><item type="str">attack.t1069.002</item><item type="str">attack.t1069</item><item type="str">attack.t1059.001</item></tags><logsource type="dict"><product type="str">windows</product><category type="str">ps_script</category><definition type="str">Requirements: Script Block Logging must be enabled</definition></logsource><detection type="dict"><selection type="dict"><key name="ScriptBlockText|contains" type="list"><item type="str">Add-Exfiltration</item><item type="str">Add-Persistence</item><item type="str">Add-RegBackdoor</item><item type="str">Add-RemoteRegBackdoor</item><item type="str">Add-ScrnSaveBackdoor</item><item type="str">Check-VM</item><item type="str">ConvertTo-Rc4ByteStream</item><item type="str">Decrypt-Hash</item><item type="str">Disable-ADIDNSNode</item><item type="str">Disable-MachineAccount</item><item type="str">Do-Exfiltration</item><item type="str">Enable-ADIDNSNode</item><item type="str">Enable-MachineAccount</item><item type="str">Enabled-DuplicateToken</item><item type="str">Exploit-Jboss</item><item type="str">Export-ADR</item><item type="str">Export-ADRCSV</item><item type="str">Export-ADRExcel</item><item type="str">Export-ADRHTML</item><item type="str">Export-ADRJSON</item><item type="str">Export-ADRXML</item><item type="str">Find-Fruit</item><item type="str">Find-GPOLocation</item><item type="str">Find-TrustedDocuments</item><item type="str">Get-ADIDNS</item><item type="str">Get-ApplicationHost</item><item type="str">Get-ChromeDump</item><item type="str">Get-ClipboardContents</item><item type="str">Get-FoxDump</item><item type="str">Get-GPPPassword</item><item type="str">Get-IndexedItem</item><item type="str">Get-KerberosAESKey</item><item type="str">Get-Keystrokes</item><item type="str">Get-LSASecret</item><item type="str">Get-MachineAccountAttribute</item><item type="str">Get-MachineAccountCreator</item><item type="str">Get-PassHashes</item><item type="str">Get-RegAlwaysInstallElevated</item><item type="str">Get-RegAutoLogon</item><item type="str">Get-RemoteBootKey</item><item type="str">Get-RemoteCachedCredential</item><item type="str">Get-RemoteLocalAccountHash</item><item type="str">Get-RemoteLSAKey</item><item type="str">Get-RemoteMachineAccountHash</item><item type="str">Get-RemoteNLKMKey</item><item type="str">Get-RickAstley</item><item type="str">Get-Screenshot</item><item type="str">Get-SecurityPackages</item><item type="str">Get-ServiceFilePermission</item><item type="str">Get-ServicePermission</item><item type="str">Get-ServiceUnquoted</item><item type="str">Get-SiteListPassword</item><item type="str">Get-System</item><item type="str">Get-TimedScreenshot</item><item type="str">Get-UnattendedInstallFile</item><item type="str">Get-Unconstrained</item><item type="str">Get-USBKeystrokes</item><item type="str">Get-VaultCredential</item><item type="str">Get-VulnAutoRun</item><item type="str">Get-VulnSchTask</item><item type="str">Grant-ADIDNSPermission</item><item type="str">Gupt-Backdoor</item><item type="str">HTTP-Login</item><item type="str">Install-ServiceBinary</item><item type="str">Install-SSP</item><item type="str">Invoke-ACLScanner</item><item type="str">Invoke-ADRecon</item><item type="str">Invoke-ADSBackdoor</item><item type="str">Invoke-AgentSmith</item><item type="str">Invoke-AllChecks</item><item type="str">Invoke-ARPScan</item><item type="str">Invoke-AzureHound</item><item type="str">Invoke-BackdoorLNK</item><item type="str">Invoke-BadPotato</item><item type="str">Invoke-BetterSafetyKatz</item><item type="str">Invoke-BypassUAC</item><item type="str">Invoke-Carbuncle</item><item type="str">Invoke-Certify</item><item type="str">Invoke-ConPtyShell</item><item type="str">Invoke-CredentialInjection</item><item type="str">Invoke-DAFT</item><item type="str">Invoke-DCSync</item><item type="str">Invoke-DinvokeKatz</item><item type="str">Invoke-DllInjection</item><item type="str">Invoke-DNSUpdate</item><item type="str">Invoke-DomainPasswordSpray</item><item type="str">Invoke-DowngradeAccount</item><item type="str">Invoke-EgressCheck</item><item type="str">Invoke-Eyewitness</item><item type="str">Invoke-FakeLogonScreen</item><item type="str">Invoke-Farmer</item><item type="str">Invoke-Get-RBCD-Threaded</item><item type="str">Invoke-Gopher</item><item type="str">Invoke-Grouper</item><item type="str">Invoke-HandleKatz</item><item type="str">Invoke-ImpersonatedProcess</item><item type="str">Invoke-ImpersonateSystem</item><item type="str">Invoke-InteractiveSystemPowerShell</item><item type="str">Invoke-Internalmonologue</item><item type="str">Invoke-Inveigh</item><item type="str">Invoke-InveighRelay</item><item type="str">Invoke-KrbRelay</item><item type="str">Invoke-LdapSignCheck</item><item type="str">Invoke-Lockless</item><item type="str">Invoke-MalSCCM</item><item type="str">Invoke-Mimikatz</item><item type="str">Invoke-Mimikittenz</item><item type="str">Invoke-MITM6</item><item type="str">Invoke-NanoDump</item><item type="str">Invoke-NetRipper</item><item type="str">Invoke-Nightmare</item><item type="str">Invoke-NinjaCopy</item><item type="str">Invoke-OfficeScrape</item><item type="str">Invoke-OxidResolver</item><item type="str">Invoke-P0wnedshell</item><item type="str">Invoke-Paranoia</item><item type="str">Invoke-PortScan</item><item type="str">Invoke-PoshRatHttp</item><item type="str">Invoke-PostExfil</item><item type="str">Invoke-PowerDump</item><item type="str">Invoke-PowerShellTCP</item><item type="str">Invoke-PowerShellWMI</item><item type="str">Invoke-PPLDump</item><item type="str">Invoke-PsExec</item><item type="str">Invoke-PSInject</item><item type="str">Invoke-PsUaCme</item><item type="str">Invoke-ReflectivePEInjection</item><item type="str">Invoke-ReverseDNSLookup</item><item type="str">Invoke-Rubeus</item><item type="str">Invoke-RunAs</item><item type="str">Invoke-SafetyKatz</item><item type="str">Invoke-SauronEye</item><item type="str">Invoke-SCShell</item><item type="str">Invoke-Seatbelt</item><item type="str">Invoke-ServiceAbuse</item><item type="str">Invoke-ShadowSpray</item><item type="str">Invoke-Sharp</item><item type="str">Invoke-Shellcode</item><item type="str">Invoke-SMBScanner</item><item type="str">Invoke-Snaffler</item><item type="str">Invoke-Spoolsample</item><item type="str">Invoke-SpraySinglePassword</item><item type="str">Invoke-SSHCommand</item><item type="str">Invoke-StandIn</item><item type="str">Invoke-StickyNotesExtract</item><item type="str">Invoke-SystemCommand</item><item type="str">Invoke-Tasksbackdoor</item><item type="str">Invoke-Tater</item><item type="str">Invoke-Thunderfox</item><item type="str">Invoke-ThunderStruck</item><item type="str">Invoke-TokenManipulation</item><item type="str">Invoke-Tokenvator</item><item type="str">Invoke-TotalExec</item><item type="str">Invoke-UrbanBishop</item><item type="str">Invoke-UserHunter</item><item type="str">Invoke-VoiceTroll</item><item type="str">Invoke-Whisker</item><item type="str">Invoke-WinEnum</item><item type="str">Invoke-winPEAS</item><item type="str">Invoke-WireTap</item><item type="str">Invoke-WmiCommand</item><item type="str">Invoke-WMIExec</item><item type="str">Invoke-WScriptBypassUAC</item><item type="str">Invoke-Zerologon</item><item type="str">MailRaider</item><item type="str">New-ADIDNSNode</item><item type="str">New-DNSRecordArray</item><item type="str">New-HoneyHash</item><item type="str">New-InMemoryModule</item><item type="str">New-MachineAccount</item><item type="str">New-SOASerialNumberArray</item><item type="str">Out-Minidump</item><item type="str">Port-Scan</item><item type="str">PowerBreach</item><item type="str">powercat </item><item type="str">PowerUp</item><item type="str">PowerView</item><item type="str">Remove-ADIDNSNode</item><item type="str">Remove-MachineAccount</item><item type="str">Remove-Update</item><item type="str">Rename-ADIDNSNode</item><item type="str">Revoke-ADIDNSPermission</item><item type="str">Set-ADIDNSNode</item><item type="str">Set-MacAttribute</item><item type="str">Set-MachineAccountAttribute</item><item type="str">Set-Wallpaper</item><item type="str">Show-TargetScreen</item><item type="str">Start-CaptureServer</item><item type="str">Start-WebcamRecorder</item><item type="str">VolumeShadowCopyTools</item></key></selection><filter_optional_amazon_ec2 type="dict"><key name="ScriptBlockText|contains" type="list"><item type="str">Get-SystemDriveInfo</item><item type="str">C:\ProgramData\Amazon\EC2-Windows\Launch\Module\</item></key></filter_optional_amazon_ec2><condition type="str">selection and not 1 of filter_optional_*</condition></detection><falsepositives type="list"><item type="str">Unknown</item></falsepositives><level type="str">high</level></root>