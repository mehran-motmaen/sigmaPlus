<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Persistence Via Disk Cleanup Handler - Autorun</title><id type="str">d4e2745c-f0c6-4bde-a3ab-b553b3f693cc</id><status type="str">experimental</status><description type="str">Detects when an attacker modifies values of the Disk Cleanup Handler in the registry to achieve persistence via autorun.
The disk cleanup manager is part of the operating system.
It displays the dialog box [â€¦] The user has the option of enabling or disabling individual handlers by selecting or clearing their check box in the disk cleanup manager&apos;s UI.
Although Windows comes with a number of disk cleanup handlers, they aren&apos;t designed to handle files produced by other applications.
Instead, the disk cleanup manager is designed to be flexible and extensible by enabling any developer to implement and register their own disk cleanup handler.
Any developer can extend the available disk cleanup services by implementing and registering a disk cleanup handler.
</description><references type="list"><item type="str">https://persistence-info.github.io/Data/diskcleanuphandler.html</item><item type="str">https://www.hexacorn.com/blog/2018/09/02/beyond-good-ol-run-key-part-86/</item></references><author type="str">Nasreddine Bencherchali (Nextron Systems)</author><date type="str">2022/07/21</date><modified type="str">2022/10/21</modified><tags type="list"><item type="str">attack.persistence</item></tags><logsource type="dict"><category type="str">registry_set</category><product type="str">windows</product></logsource><detection type="dict"><root type="dict"><EventType type="str">SetValue</EventType><key name="TargetObject|contains" type="str">\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VolumeCaches\</key></root><selection_autorun type="dict"><key name="TargetObject|contains" type="str">\Autorun</key><Details type="str">DWORD (0x00000001)</Details></selection_autorun><selection_pre_after type="dict"><key name="TargetObject|contains" type="list"><item type="str">\CleanupString</item><item type="str">\PreCleanupString</item></key><key name="Details|contains" type="list"><item type="str">cmd</item><item type="str">powershell</item><item type="str">rundll32</item><item type="str">mshta</item><item type="str">cscript</item><item type="str">wscript</item><item type="str">wsl</item><item type="str">\Users\Public\</item><item type="str">\Windows\TEMP\</item><item type="str">\Microsoft\Windows\Start Menu\Programs\Startup\</item></key></selection_pre_after><condition type="str">root and 1 of selection_*</condition></detection><falsepositives type="list"><item type="str">Unknown</item></falsepositives><level type="str">medium</level></root>