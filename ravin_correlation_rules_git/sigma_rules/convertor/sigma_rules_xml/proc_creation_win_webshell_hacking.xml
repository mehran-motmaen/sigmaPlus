<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Webshell Hacking Activity Patterns</title><id type="str">4ebc877f-4612-45cb-b3a5-8e3834db36c9</id><status type="str">experimental</status><description type="str">Detects certain parent child patterns found in cases in which a webshell is used to perform certain credential dumping or exfiltration activities on a compromised system</description><references type="list"><item type="str">https://youtu.be/7aemGhaE9ds?t=641</item></references><author type="str">Florian Roth (Nextron Systems)</author><date type="str">2022/03/17</date><modified type="str">2022/08/04</modified><tags type="list"><item type="str">attack.persistence</item><item type="str">attack.t1505.003</item><item type="str">attack.t1018</item><item type="str">attack.t1033</item><item type="str">attack.t1087</item></tags><logsource type="dict"><category type="str">process_creation</category><product type="str">windows</product></logsource><detection type="dict"><selection_webserver_image type="dict"><key name="ParentImage|endswith" type="list"><item type="str">\w3wp.exe</item><item type="str">\php-cgi.exe</item><item type="str">\nginx.exe</item><item type="str">\httpd.exe</item><item type="str">\caddy.exe</item><item type="str">\ws_tomcatservice.exe</item></key></selection_webserver_image><selection_webserver_characteristics_tomcat1 type="dict"><key name="ParentImage|endswith" type="list"><item type="str">\java.exe</item><item type="str">\javaw.exe</item></key><key name="ParentImage|contains" type="list"><item type="str">-tomcat-</item><item type="str">\tomcat</item></key></selection_webserver_characteristics_tomcat1><selection_webserver_characteristics_tomcat2 type="dict"><key name="ParentImage|endswith" type="list"><item type="str">\java.exe</item><item type="str">\javaw.exe</item></key><key name="CommandLine|contains" type="list"><item type="str">catalina.jar</item><item type="str">CATALINA_HOME</item></key></selection_webserver_characteristics_tomcat2><selection_child_1 type="dict"><key name="CommandLine|contains|all" type="list"><item type="str">rundll32</item><item type="str">comsvcs</item></key></selection_child_1><selection_child_2 type="dict"><key name="CommandLine|contains|all" type="list"><item type="str"> -hp</item><item type="str"> a </item><item type="str"> -m</item></key></selection_child_2><selection_child_3 type="dict"><key name="CommandLine|contains|all" type="list"><item type="str">net</item><item type="str"> user </item><item type="str"> /add</item></key></selection_child_3><selection_child_4 type="dict"><key name="CommandLine|contains|all" type="list"><item type="str">net</item><item type="str"> localgroup </item><item type="str"> administrators </item><item type="str">/add</item></key></selection_child_4><selection_child_5 type="dict"><key name="Image|endswith" type="list"><item type="str">\ntdsutil.exe</item><item type="str">\ldifde.exe</item><item type="str">\adfind.exe</item><item type="str">\procdump.exe</item><item type="str">\Nanodump.exe</item><item type="str">\vssadmin.exe</item><item type="str">\fsutil.exe</item></key></selection_child_5><selection_child_6 type="dict"><key name="CommandLine|contains" type="list"><item type="str"> -NoP </item><item type="str"> -W Hidden </item><item type="str"> -decode </item><item type="str"> /decode </item><item type="str">reg save </item><item type="str">.downloadstring(</item><item type="str">.downloadfile(</item><item type="str">FromBase64String</item><item type="str"> /ticket:</item><item type="str"> sekurlsa</item><item type="str">.dmp full</item><item type="str">process call create</item><item type="str">whoami /priv</item></key></selection_child_6><condition type="str">1 of selection_webserver* and 1 of selection_child*</condition></detection><falsepositives type="list"><item type="str">Unlikely</item></falsepositives><level type="str">high</level></root>