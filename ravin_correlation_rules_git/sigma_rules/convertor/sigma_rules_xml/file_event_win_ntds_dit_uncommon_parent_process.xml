<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">NTDS.DIT Creation By Uncommon Parent Process</title><id type="str">4e7050dd-e548-483f-b7d6-527ab4fa784d</id><related type="list"><item type="dict"><id type="str">11b1ed55-154d-4e82-8ad7-83739298f720</id><type type="str">similar</type></item></related><status type="str">test</status><description type="str">Detects creation of a file named &quot;ntds.dit&quot; (Active Directory Database) by an uncommon parent process or directory</description><references type="list"><item type="str">https://www.ired.team/offensive-security/credential-access-and-credential-dumping/ntds.dit-enumeration</item><item type="str">https://www.n00py.io/2022/03/manipulating-user-passwords-without-mimikatz/</item><item type="str">https://pentestlab.blog/tag/ntds-dit/</item><item type="str">https://github.com/samratashok/nishang/blob/414ee1104526d7057f9adaeee196d91ae447283e/Gather/Copy-VSS.ps1</item></references><author type="str">Florian Roth (Nextron Systems)</author><date type="str">2022/03/11</date><modified type="str">2023/01/05</modified><tags type="list"><item type="str">attack.credential_access</item><item type="str">attack.t1003.003</item></tags><logsource type="dict"><product type="str">windows</product><category type="str">file_event</category><definition type="str">Requirements: The &quot;ParentImage&quot; field is not available by default on EID 11 of Sysmon logs. To be able to use this rule to the full extent you need to enrich the log with additional ParentImage data</definition></logsource><detection type="dict"><selection_file type="dict"><key name="TargetFilename|endswith" type="str">\ntds.dit</key></selection_file><selection_process_parent type="dict"><key name="ParentImage|endswith" type="list"><item type="str">\cscript.exe</item><item type="str">\httpd.exe</item><item type="str">\nginx.exe</item><item type="str">\php-cgi.exe</item><item type="str">\powershell.exe</item><item type="str">\pwsh.exe</item><item type="str">\w3wp.exe</item><item type="str">\wscript.exe</item></key></selection_process_parent><selection_process_parent_path type="dict"><key name="ParentImage|contains" type="list"><item type="str">\apache</item><item type="str">\tomcat</item><item type="str">\AppData\</item><item type="str">\Temp\</item><item type="str">\Public\</item><item type="str">\PerfLogs\</item></key></selection_process_parent_path><condition type="str">selection_file and 1 of selection_process_*</condition></detection><falsepositives type="list"><item type="str">Unknown</item></falsepositives><level type="str">high</level></root>