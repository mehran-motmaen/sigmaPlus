<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Suspicious PowerShell Invocations - Specific</title><id type="str">ae7fbf8e-f3cb-49fd-8db4-5f3bed522c71</id><related type="list"><item type="dict"><id type="str">fce5f582-cc00-41e1-941a-c6fabf0fdb8c</id><type type="str">derived</type></item><item type="dict"><id type="str">8ff28fdd-e2fa-4dfa-aeda-ef3d61c62090</id><type type="str">similar</type></item><item type="dict"><id type="str">536e2947-3729-478c-9903-745aaffe60d2</id><type type="str">similar</type></item></related><status type="str">experimental</status><description type="str">Detects suspicious PowerShell invocation command parameters</description><author type="str">Florian Roth (Nextron Systems), Jonhnathan Ribeiro</author><date type="str">2017/03/05</date><modified type="str">2023/01/05</modified><tags type="list"><item type="str">attack.execution</item><item type="str">attack.t1059.001</item></tags><logsource type="dict"><product type="str">windows</product><category type="str">ps_script</category><definition type="str">Requirements: Script Block Logging must be enabled</definition></logsource><detection type="dict"><selection_convert_b64 type="dict"><key name="ScriptBlockText|contains|all" type="list"><item type="str">-nop</item><item type="str"> -w </item><item type="str">hidden</item><item type="str"> -c </item><item type="str">[Convert]::FromBase64String</item></key></selection_convert_b64><selection_iex_selection type="dict"><key name="ScriptBlockText|contains|all" type="list"><item type="str"> -w </item><item type="str">hidden</item><item type="str">-noni</item><item type="str">-nop</item><item type="str"> -c </item><item type="str">iex</item><item type="str">New-Object</item></key></selection_iex_selection><selection_enc_selection type="dict"><key name="ScriptBlockText|contains|all" type="list"><item type="str"> -w </item><item type="str">hidden</item><item type="str">-ep</item><item type="str">bypass</item><item type="str">-Enc</item></key></selection_enc_selection><selection_reg_selection type="dict"><key name="ScriptBlockText|contains|all" type="list"><item type="str">powershell</item><item type="str">reg</item><item type="str">add</item><item type="str">HKCU\software\microsoft\windows\currentversion\run</item></key></selection_reg_selection><selection_webclient_selection type="dict"><key name="ScriptBlockText|contains|all" type="list"><item type="str">bypass</item><item type="str">-noprofile</item><item type="str">-windowstyle</item><item type="str">hidden</item><item type="str">new-object</item><item type="str">system.net.webclient</item><item type="str">.download</item></key></selection_webclient_selection><selection_iex_webclient type="dict"><key name="ScriptBlockText|contains|all" type="list"><item type="str">iex</item><item type="str">New-Object</item><item type="str">Net.WebClient</item><item type="str">.Download</item></key></selection_iex_webclient><filter_chocolatey type="dict"><key name="ScriptBlockText|contains" type="list"><item type="str">(New-Object System.Net.WebClient).DownloadString(&apos;https://community.chocolatey.org/install.ps1</item><item type="str">(New-Object System.Net.WebClient).DownloadString(&apos;https://chocolatey.org/install.ps1&apos;)</item><item type="str">Write-ChocolateyWarning</item></key></filter_chocolatey><condition type="str">1 of selection_* and not 1 of filter_*</condition></detection><falsepositives type="list"><item type="str">Unknown</item></falsepositives><level type="str">high</level></root>