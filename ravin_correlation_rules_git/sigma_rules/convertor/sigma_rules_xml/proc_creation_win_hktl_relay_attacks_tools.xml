<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Potential SMB Relay Attack Tool Execution</title><id type="str">5589ab4f-a767-433c-961d-c91f3f704db1</id><status type="str">test</status><description type="str">Detects different hacktools used for relay attacks on Windows for privilege escalation</description><references type="list"><item type="str">https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/</item><item type="str">https://pentestlab.blog/2017/04/13/hot-potato/</item><item type="str">https://github.com/ohpe/juicy-potato</item><item type="str">https://hunter2.gitbook.io/darthsidious/other/war-stories/domain-admin-in-30-minutes</item><item type="str">https://hunter2.gitbook.io/darthsidious/execution/responder-with-ntlm-relay-and-empire</item><item type="str">https://www.localpotato.com/</item></references><author type="str">Florian Roth (Nextron Systems)</author><date type="str">2021/07/24</date><modified type="str">2023/02/14</modified><tags type="list"><item type="str">attack.execution</item><item type="str">attack.t1557.001</item></tags><logsource type="dict"><category type="str">process_creation</category><product type="str">windows</product></logsource><detection type="dict"><selection_pe type="dict"><key name="Image|contains" type="list"><item type="str">PetitPotam</item><item type="str">RottenPotato</item><item type="str">HotPotato</item><item type="str">JuicyPotato</item><item type="str">\just_dce_</item><item type="str">Juicy Potato</item><item type="str">\temp\rot.exe</item><item type="str">\Potato.exe</item><item type="str">\SpoolSample.exe</item><item type="str">\Responder.exe</item><item type="str">\smbrelayx</item><item type="str">\ntlmrelayx</item><item type="str">\LocalPotato</item></key></selection_pe><selection_script type="dict"><key name="CommandLine|contains" type="list"><item type="str">Invoke-Tater</item><item type="str"> smbrelay</item><item type="str"> ntlmrelay</item><item type="str">cme smb </item><item type="str"> /ntlm:NTLMhash </item><item type="str">Invoke-PetitPotam</item><item type="str">.exe -t * -p </item></key></selection_script><selection_juicypotato_enum type="dict"><key name="CommandLine|contains" type="str">.exe -c &quot;{</key><key name="CommandLine|endswith" type="str">}&quot; -z</key></selection_juicypotato_enum><filter_hotpotatoes type="dict"><key name="Image|contains" type="list"><item type="str">HotPotatoes6</item><item type="str">HotPotatoes7</item><item type="str">HotPotatoes </item></key></filter_hotpotatoes><condition type="str">1 of selection_* and not 1 of filter_*</condition></detection><falsepositives type="list"><item type="str">Legitimate files with these rare hacktool names</item></falsepositives><level type="str">critical</level></root>