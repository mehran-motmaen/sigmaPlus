<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">HackTool - CrackMapExec Execution</title><id type="str">42a993dd-bb3e-48c8-b372-4d6684c4106c</id><status type="str">test</status><description type="str">This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced.</description><references type="list"><item type="str">https://mpgn.gitbook.io/crackmapexec/smb-protocol/authentication/checking-credentials-local</item><item type="str">https://www.mandiant.com/resources/telegram-malware-iranian-espionage</item><item type="str">https://www.infosecmatter.com/crackmapexec-module-library/?cmem=mssql-mimikatz</item><item type="str">https://www.infosecmatter.com/crackmapexec-module-library/?cmem=smb-pe_inject</item></references><author type="str">Florian Roth (Nextron Systems)</author><date type="str">2022/02/25</date><modified type="str">2023/03/08</modified><logsource type="dict"><category type="str">process_creation</category><product type="str">windows</product></logsource><detection type="dict"><selection_binary type="dict"><key name="Image|endswith" type="str">\crackmapexec.exe</key></selection_binary><selection_special type="dict"><key name="CommandLine|contains" type="str"> -M pe_inject </key></selection_special><selection_execute type="dict"><key name="CommandLine|contains|all" type="list"><item type="str"> --local-auth</item><item type="str"> -u </item><item type="str"> -x </item></key></selection_execute><selection_hash type="dict"><key name="CommandLine|contains|all" type="list"><item type="str"> --local-auth</item><item type="str"> -u </item><item type="str"> -p </item><item type="str"> -H &apos;NTHASH&apos;</item></key></selection_hash><selection_module_mssql type="dict"><key name="CommandLine|contains|all" type="list"><item type="str"> mssql </item><item type="str"> -u </item><item type="str"> -p </item><item type="str"> -M </item><item type="str"> -d </item></key></selection_module_mssql><selection_module_smb1 type="dict"><key name="CommandLine|contains|all" type="list"><item type="str"> smb </item><item type="str"> -u </item><item type="str"> -H </item><item type="str"> -M </item><item type="str"> -o </item></key></selection_module_smb1><selection_module_smb2 type="dict"><key name="CommandLine|contains|all" type="list"><item type="str"> smb </item><item type="str"> -u </item><item type="str"> -p </item><item type="str"> --local-auth</item></key></selection_module_smb2><part_localauth_1 type="dict"><key name="CommandLine|contains|all" type="list"><item type="str"> --local-auth</item><item type="str"> -u </item><item type="str"> -p </item></key></part_localauth_1><part_localauth_2 type="dict"><key name="CommandLine|contains|all" type="list"><item type="str"> 10.</item><item type="str"> 192.168.</item><item type="str">/24 </item></key></part_localauth_2><condition type="str">1 of selection_* or all of part_localauth*</condition></detection><fields type="list"><item type="str">ComputerName</item><item type="str">User</item><item type="str">CommandLine</item></fields><falsepositives type="list"><item type="str">Unknown</item></falsepositives><level type="str">high</level></root>