<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Suspicious DNS Z Flag Bit Set</title><id type="str">ede05abc-2c9e-4624-9944-9ff17fdc0bf5</id><status type="str">experimental</status><description type="str">The DNS Z flag is bit within the DNS protocol header that is, per the IETF design, meant to be used reserved (unused).
Although recently it has been used in DNSSec, the value being set to anything other than 0 should be rare.
Otherwise if it is set to non 0 and DNSSec is being used, then excluding the legitimate domains is low effort and high reward.
Determine if multiple of these files were accessed in a short period of time to further enhance the possibility of seeing if this was a one off or the possibility of larger sensitive file gathering.
This Sigma query is designed to accompany the Corelight Threat Hunting Guide, which can be found here: https://www3.corelight.com/corelights-introductory-guide-to-threat-hunting-with-zeek-bro-logs&apos;
</description><references type="list"><item type="str">https://twitter.com/neu5ron/status/1346245602502443009</item><item type="str">https://tdm.socprime.com/tdm/info/eLbyj4JjI15v#sigma</item><item type="str">https://tools.ietf.org/html/rfc2929#section-2.1</item><item type="str">https://www.netresec.com/?page=Blog&amp;month=2021-01&amp;post=Finding-Targeted-SUNBURST-Victims-with-pDNS</item></references><author type="str">@neu5ron, SOC Prime Team, Corelight</author><date type="str">2021/05/04</date><modified type="str">2022/11/29</modified><tags type="list"><item type="str">attack.t1095</item><item type="str">attack.t1571</item><item type="str">attack.command_and_control</item></tags><logsource type="dict"><product type="str">zeek</product><service type="str">dns</service></logsource><detection type="dict"><z_flag_unset type="dict"><Z type="int">0</Z></z_flag_unset><most_probable_valid_domain type="dict"><key name="query|contains" type="str">.</key></most_probable_valid_domain><exclude_tlds type="dict"><key name="query|endswith" type="list"><item type="str">.arpa</item><item type="str">.local</item><item type="str">.ultradns.net</item><item type="str">.twtrdns.net</item><item type="str">.azuredns-prd.info</item><item type="str">.azure-dns.com</item><item type="str">.azuredns-ff.info</item><item type="str">.azuredns-ff.org</item><item type="str">.azuregov-dns.org</item></key></exclude_tlds><exclude_query_types type="dict"><qtype_name type="list"><item type="str">ns</item><item type="str">mx</item></qtype_name></exclude_query_types><exclude_responses type="dict"><key name="answers|endswith" type="str">\\x00</key></exclude_responses><exclude_netbios type="dict"><id.resp_p type="list"><item type="int">137</item><item type="int">138</item><item type="int">139</item></id.resp_p></exclude_netbios><condition type="str">not z_flag_unset and most_probable_valid_domain and not (exclude_tlds or exclude_query_types or exclude_responses or exclude_netbios)</condition></detection><fields type="list"><item type="str">ts</item><item type="str">id.orig_h</item><item type="str">id.orig_p</item><item type="str">id.resp_h</item><item type="str">id.resp_p</item><item type="str">proto</item><item type="str">qtype_name</item><item type="str">qtype</item><item type="str">query</item><item type="str">answers</item><item type="str">rcode</item><item type="str">rcode_name</item><item type="str">trans_id</item><item type="str">qtype</item><item type="str">ttl</item><item type="str">AA</item><item type="str">uid</item></fields><falsepositives type="list"><item type="str">Internal or legitimate external domains using DNSSec. Verify if these are legitimate DNSSec domains and then exclude them.</item><item type="str">If you work in a Public Sector then it may be good to exclude things like endswith &quot;.edu&quot;, &quot;.gov&quot; and or &quot;.mil&quot;</item></falsepositives><level type="str">medium</level></root>