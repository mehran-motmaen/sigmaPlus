<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Potential Registry Persistence Attempt Via Windows Telemetry</title><id type="str">73a883d0-0348-4be4-a8d8-51031c2564f8</id><related type="list"><item type="dict"><id type="str">4e8d5fd3-c959-441f-a941-f73d0cdcdca5</id><type type="str">obsoletes</type></item></related><status type="str">test</status><description type="str">Detects potential persistence behavior using the windows telemetry registry key.
Windows telemetry makes use of the binary CompatTelRunner.exe to run a variety of commands and perform the actual telemetry collections.
This binary was created to be easily extensible, and to that end, it relies on the registry to instruct on which commands to run.
The problem is, it will run any arbitrary command without restriction of location or type.
</description><references type="list"><item type="str">https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence/</item></references><author type="str">Lednyov Alexey, oscd.community, Sreeman</author><date type="str">2020/10/16</date><modified type="str">2023/08/01</modified><tags type="list"><item type="str">attack.persistence</item><item type="str">attack.t1053.005</item></tags><logsource type="dict"><category type="str">registry_set</category><product type="str">windows</product><definition type="str">Requirements: Sysmon config that monitors \SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\TelemetryController subkey of the HKLM hives</definition></logsource><detection type="dict"><selection type="dict"><EventType type="str">SetValue</EventType><key name="TargetObject|contains" type="str">\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\TelemetryController\</key><key name="TargetObject|endswith" type="str">\Command</key><key name="Details|contains" type="list"><item type="str">.bat</item><item type="str">.bin</item><item type="str">.cmd</item><item type="str">.dat</item><item type="str">.dll</item><item type="str">.exe</item><item type="str">.hta</item><item type="str">.jar</item><item type="str">.js</item><item type="str">.msi</item><item type="str">.ps</item><item type="str">.sh</item><item type="str">.vb</item></key></selection><filter_main_generic type="dict"><key name="Details|contains" type="list"><item type="str">\system32\CompatTelRunner.exe</item><item type="str">\system32\DeviceCensus.exe</item></key></filter_main_generic><condition type="str">selection and not 1 of filter_main_*</condition></detection><falsepositives type="list"><item type="str">Unknown</item></falsepositives><level type="str">high</level></root>