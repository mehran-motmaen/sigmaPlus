<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Meterpreter or Cobalt Strike Getsystem Service Installation - Security</title><id type="str">ecbc5e16-58e0-4521-9c60-eb9a7ea4ad34</id><related type="list"><item type="dict"><id type="str">843544a7-56e0-4dcc-a44f-5cc266dd97d6</id><type type="str">derived</type></item></related><status type="str">test</status><description type="str">Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation</description><references type="list"><item type="str">https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment</item><item type="str">https://blog.cobaltstrike.com/2014/04/02/what-happens-when-i-type-getsystem/</item></references><author type="str">Teymur Kheirkhabarov, Ecco, Florian Roth</author><date type="str">2019/10/26</date><modified type="str">2022/11/29</modified><tags type="list"><item type="str">attack.privilege_escalation</item><item type="str">attack.t1134.001</item><item type="str">attack.t1134.002</item></tags><logsource type="dict"><product type="str">windows</product><service type="str">security</service><definition type="str">The &apos;System Security Extension&apos; audit subcategory need to be enabled to log the EID 4697</definition></logsource><detection type="dict"><selection_id type="dict"><EventID type="int">4697</EventID></selection_id><selection type="list"><item type="dict"><key name="ServiceFileName|contains|all" type="list"><item type="str">cmd</item><item type="str">/c</item><item type="str">echo</item><item type="str">\pipe\</item></key></item><item type="dict"><key name="ServiceFileName|contains|all" type="list"><item type="str">%COMSPEC%</item><item type="str">/c</item><item type="str">echo</item><item type="str">\pipe\</item></key></item><item type="dict"><key name="ServiceFileName|contains|all" type="list"><item type="str">cmd.exe</item><item type="str">/c</item><item type="str">echo</item><item type="str">\pipe\</item></key></item><item type="dict"><key name="ServiceFileName|contains|all" type="list"><item type="str">rundll32</item><item type="str">.dll,a</item><item type="str">/p:</item></key></item></selection><condition type="str">selection_id and selection</condition></detection><fields type="list"><item type="str">ComputerName</item><item type="str">SubjectDomainName</item><item type="str">SubjectUserName</item><item type="str">ServiceFileName</item></fields><falsepositives type="list"><item type="str">Highly unlikely</item></falsepositives><level type="str">critical</level></root>