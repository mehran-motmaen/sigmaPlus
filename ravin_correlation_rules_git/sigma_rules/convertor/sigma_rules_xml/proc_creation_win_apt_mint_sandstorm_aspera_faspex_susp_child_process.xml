<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Mint Sandstorm - AsperaFaspex Suspicious Process Execution</title><id type="str">91048c0d-5b81-4b85-a099-c9ee4fb87979</id><status type="str">test</status><description type="str">Detects suspicious execution from AsperaFaspex as seen used by Mint Sandstorm</description><references type="list"><item type="str">https://www.microsoft.com/en-us/security/blog/2023/04/18/nation-state-threat-actor-mint-sandstorm-refines-tradecraft-to-attack-high-value-targets/</item></references><author type="str">Nasreddine Bencherchali (Nextron Systems), MSTIC (idea)</author><date type="str">2023/04/20</date><modified type="str">2023/04/25</modified><tags type="list"><item type="str">attack.execution</item><item type="str">detection.emerging_threats</item></tags><logsource type="dict"><category type="str">process_creation</category><product type="str">windows</product></logsource><detection type="dict"><selection_parent type="dict"><key name="ParentImage|contains|all" type="list"><item type="str">aspera</item><item type="str">\ruby</item></key></selection_parent><selection_special_child_powershell_img type="dict"><key name="Image|endswith" type="list"><item type="str">\powershell.exe</item><item type="str">\powershell_ise.exe</item></key></selection_special_child_powershell_img><selection_special_child_powershell_cli type="list"><item type="dict"><key name="CommandLine|contains" type="list"><item type="str"> echo </item><item type="str">-dumpmode</item><item type="str">-ssh</item><item type="str">.dmp</item><item type="str">add-MpPreference</item><item type="str">adscredentials</item><item type="str">bitsadmin</item><item type="str">certutil</item><item type="str">csvhost.exe</item><item type="str">DownloadFile</item><item type="str">DownloadString</item><item type="str">dsquery</item><item type="str">ekern.exe</item><item type="str">FromBase64String</item><item type="str">iex </item><item type="str">iex(</item><item type="str">Invoke-Expression</item><item type="str">Invoke-WebRequest</item><item type="str">localgroup administrators</item><item type="str">net group</item><item type="str">net user</item><item type="str">o365accountconfiguration</item><item type="str">query session</item><item type="str">samaccountname=</item><item type="str">set-MpPreference</item><item type="str">svhost.exe</item><item type="str">System.IO.Compression</item><item type="str">System.IO.MemoryStream</item><item type="str">usoprivate</item><item type="str">usoshared</item><item type="str">whoami</item></key></item><item type="dict"><key name="CommandLine|re" type="str">[-/â€“][Ee^]{1,2}[ncodema^]*\s[A-Za-z0-9+/=]{15,}</key></item></selection_special_child_powershell_cli><selection_special_child_lsass_1 type="dict"><key name="CommandLine|contains" type="str">lsass</key></selection_special_child_lsass_1><selection_special_child_lsass_2 type="dict"><key name="CommandLine|contains" type="list"><item type="str">procdump</item><item type="str">tasklist</item><item type="str">findstr</item></key></selection_special_child_lsass_2><selection_child_wget type="dict"><key name="Image|endswith" type="str">\wget.exe</key><key name="CommandLine|contains" type="str">http</key></selection_child_wget><selection_child_curl type="dict"><key name="Image|endswith" type="str">\curl.exe</key><key name="CommandLine|contains" type="str">http</key></selection_child_curl><selection_child_script type="dict"><key name="CommandLine|contains" type="list"><item type="str">E:jscript</item><item type="str">e:vbscript</item></key></selection_child_script><selection_child_localgroup type="dict"><key name="CommandLine|contains|all" type="list"><item type="str">localgroup Administrators</item><item type="str">/add</item></key></selection_child_localgroup><selection_child_net type="dict"><key name="CommandLine|contains" type="str">net</key><key name="CommandLine|contains|all" type="list"><item type="str">user</item><item type="str">/add</item></key></selection_child_net><selection_child_reg type="list"><item type="dict"><key name="CommandLine|contains|all" type="list"><item type="str">reg add</item><item type="str">DisableAntiSpyware</item><item type="str">\Microsoft\Windows Defender</item></key></item><item type="dict"><key name="CommandLine|contains|all" type="list"><item type="str">reg add</item><item type="str">DisableRestrictedAdmin</item><item type="str">CurrentControlSet\Control\Lsa</item></key></item></selection_child_reg><selection_child_wmic_1 type="dict"><key name="CommandLine|contains|all" type="list"><item type="str">wmic</item><item type="str">process call create</item></key></selection_child_wmic_1><selection_child_wmic_2 type="dict"><key name="CommandLine|contains|all" type="list"><item type="str">wmic</item><item type="str">delete</item><item type="str">shadowcopy</item></key></selection_child_wmic_2><selection_child_vssadmin type="dict"><key name="CommandLine|contains|all" type="list"><item type="str">vssadmin</item><item type="str">delete</item><item type="str">shadows</item></key></selection_child_vssadmin><selection_child_wbadmin type="dict"><key name="CommandLine|contains|all" type="list"><item type="str">wbadmin</item><item type="str">delete</item><item type="str">catalog</item></key></selection_child_wbadmin><condition type="str">selection_parent and (all of selection_special_child_powershell_* or all of selection_special_child_lsass_* or 1 of selection_child_*)</condition></detection><falsepositives type="list"><item type="str">Unlikely</item></falsepositives><level type="str">critical</level></root>