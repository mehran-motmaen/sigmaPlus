<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Possible Shadow Credentials Added</title><id type="str">f598ea0c-c25a-4f72-a219-50c44411c791</id><status type="str">experimental</status><description type="str">Detects possible addition of shadow credentials to an active directory object.</description><references type="list"><item type="str">https://www.elastic.co/guide/en/security/8.4/potential-shadow-credentials-added-to-ad-object.html</item><item type="str">https://cyberstoph.org/posts/2022/03/detecting-shadow-credentials/</item><item type="str">https://twitter.com/SBousseaden/status/1581300963650187264?</item></references><author type="str">Nasreddine Bencherchali (Nextron Systems), Elastic (idea)</author><date type="str">2022/10/17</date><tags type="list"><item type="str">attack.credential_access</item><item type="str">attack.t1556</item></tags><logsource type="dict"><product type="str">windows</product><service type="str">security</service><definition type="str">The &quot;Audit Directory Service Changes&quot; logging policy must be configured in order to receive events. Audit events are generated only for objects with configured system access control lists (SACLs). Audit events are generated only for objects with configured system access control lists (SACLs) and only when accessed in a manner that matches their SACL settings. This policy covers the following events ids - 5136, 5137, 5138, 5139, 5141. Note that the default policy does not cover User objects. For that a custom AuditRule need to be setup (See https://github.com/OTRF/Set-AuditRule)</definition></logsource><detection type="dict"><selection type="dict"><EventID type="int">5136</EventID><AttributeLDAPDisplayName type="str">msDS-KeyCredentialLink</AttributeLDAPDisplayName></selection><condition type="str">selection</condition></detection><falsepositives type="list"><item type="str">Modifications in the msDS-KeyCredentialLink attribute can be done legitimately by the Azure AD Connect synchronization account or the ADFS service account. These accounts can be added as Exceptions. (From elastic FP section)</item></falsepositives><level type="str">high</level></root>