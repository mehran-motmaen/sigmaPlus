<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Tamper Windows Defender - ScriptBlockLogging</title><id type="str">14c71865-6cd3-44ae-adaa-1db923fae5f2</id><related type="list"><item type="dict"><id type="str">ec19ebab-72dc-40e1-9728-4c0b805d722c</id><type type="str">derived</type></item></related><status type="str">experimental</status><description type="str">Detects PowerShell scripts attempting to disable scheduled scanning and other parts of Windows Defender ATP or set default actions to allow.</description><references type="list"><item type="str">https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md</item><item type="str">https://docs.microsoft.com/en-us/powershell/module/defender/set-mppreference?view=windowsserver2022-ps</item><item type="str">https://bidouillesecurity.com/disable-windows-defender-in-powershell/</item></references><author type="str">frack113, elhoim, Tim Shelton (fps, alias support), Swachchhanda Shrawan Poudel, Nasreddine Bencherchali (Nextron Systems)</author><date type="str">2022/01/16</date><modified type="str">2023/06/21</modified><tags type="list"><item type="str">attack.defense_evasion</item><item type="str">attack.t1562.001</item></tags><logsource type="dict"><product type="str">windows</product><category type="str">ps_script</category><definition type="str">Requirements: Script Block Logging must be enabled</definition></logsource><detection type="dict"><selection_options_disabling_preference type="dict"><key name="ScriptBlockText|contains" type="str">Set-MpPreference</key></selection_options_disabling_preference><selection_options_disabling_function type="dict"><key name="ScriptBlockText|contains" type="list"><item type="str">-dbaf $true</item><item type="str">-dbaf 1</item><item type="str">-dbm $true</item><item type="str">-dbm 1</item><item type="str">-dips $true</item><item type="str">-dips 1</item><item type="str">-DisableArchiveScanning $true</item><item type="str">-DisableArchiveScanning 1</item><item type="str">-DisableBehaviorMonitoring $true</item><item type="str">-DisableBehaviorMonitoring 1</item><item type="str">-DisableBlockAtFirstSeen $true</item><item type="str">-DisableBlockAtFirstSeen 1</item><item type="str">-DisableIntrusionPreventionSystem $true</item><item type="str">-DisableIntrusionPreventionSystem 1</item><item type="str">-DisableIOAVProtection $true</item><item type="str">-DisableIOAVProtection 1</item><item type="str">-DisableRealtimeMonitoring $true</item><item type="str">-DisableRealtimeMonitoring 1</item><item type="str">-DisableRemovableDriveScanning $true</item><item type="str">-DisableRemovableDriveScanning 1</item><item type="str">-DisableScanningMappedNetworkDrivesForFullScan $true</item><item type="str">-DisableScanningMappedNetworkDrivesForFullScan 1</item><item type="str">-DisableScanningNetworkFiles $true</item><item type="str">-DisableScanningNetworkFiles 1</item><item type="str">-DisableScriptScanning $true</item><item type="str">-DisableScriptScanning 1</item><item type="str">-drdsc $true</item><item type="str">-drdsc 1</item><item type="str">-drtm $true</item><item type="str">-drtm 1</item><item type="str">-dscrptsc $true</item><item type="str">-dscrptsc 1</item><item type="str">-dsmndf $true</item><item type="str">-dsmndf 1</item><item type="str">-dsnf $true</item><item type="str">-dsnf 1</item><item type="str">-dss $true</item><item type="str">-dss 1</item></key></selection_options_disabling_function><selection_other_default_actions_allow type="dict"><key name="ScriptBlockText|contains" type="str">Set-MpPreference</key></selection_other_default_actions_allow><selection_other_default_actions_func type="dict"><key name="ScriptBlockText|contains" type="list"><item type="str">HighThreatDefaultAction Allow</item><item type="str">htdefac Allow</item><item type="str">LowThreatDefaultAction Allow</item><item type="str">ltdefac Allow</item><item type="str">ModerateThreatDefaultAction Allow</item><item type="str">mtdefac Allow</item><item type="str">SevereThreatDefaultAction Allow</item><item type="str">stdefac Allow</item></key></selection_other_default_actions_func><condition type="str">all of selection_options_disabling_* or all of selection_other_default_actions_*</condition></detection><falsepositives type="list"><item type="str">Legitimate PowerShell scripts that disable Windows Defender for troubleshooting purposes. Must be investigated.</item></falsepositives><level type="str">high</level></root>