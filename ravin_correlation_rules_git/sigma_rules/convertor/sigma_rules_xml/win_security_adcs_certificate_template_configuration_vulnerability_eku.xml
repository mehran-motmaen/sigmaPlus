<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">ADCS Certificate Template Configuration Vulnerability with Risky EKU</title><id type="str">bfbd3291-de87-4b7c-88a2-d6a5deb28668</id><status type="str">test</status><description type="str">Detects certificate creation with template allowing risk permission subject and risky EKU</description><references type="list"><item type="str">https://www.specterops.io/assets/resources/Certified_Pre-Owned.pdf</item></references><author type="str">Orlinum , BlueDefenZer</author><date type="str">2021/11/17</date><modified type="str">2022/12/25</modified><tags type="list"><item type="str">attack.privilege_escalation</item><item type="str">attack.credential_access</item></tags><logsource type="dict"><product type="str">windows</product><service type="str">security</service><definition type="str">Certificate services loaded a template would trigger event ID 4898 and certificate Services template was updated would trigger event ID 4899. A risk permission seems to be coming if template contain specific flag with risky EKU.</definition></logsource><detection type="dict"><selection10 type="dict"><EventID type="int">4898</EventID><key name="TemplateContent|contains" type="list"><item type="str">1.3.6.1.5.5.7.3.2</item><item type="str">1.3.6.1.5.2.3.4</item><item type="str">1.3.6.1.4.1.311.20.2.2</item><item type="str">2.5.29.37.0</item></key></selection10><selection11 type="dict"><key name="TemplateContent|contains" type="str">CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT</key></selection11><selection20 type="dict"><EventID type="int">4899</EventID><key name="NewTemplateContent|contains" type="list"><item type="str">1.3.6.1.5.5.7.3.2</item><item type="str">1.3.6.1.5.2.3.4</item><item type="str">1.3.6.1.4.1.311.20.2.2</item><item type="str">2.5.29.37.0</item></key></selection20><selection21 type="dict"><key name="NewTemplateContent|contains" type="str">CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT</key></selection21><condition type="str">(selection10 and selection11) or (selection20 and selection21)</condition></detection><falsepositives type="list"><item type="str">Administrator activity</item><item type="str">Proxy SSL certificate with subject modification</item><item type="str">Smart card enrollement</item></falsepositives><level type="str">high</level></root>