<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Uncommon Userinit Child Process</title><id type="str">0a98a10c-685d-4ab0-bddc-b6bdd1d48458</id><related type="list"><item type="dict"><id type="str">21d856f9-9281-4ded-9377-51a1a6e2a432</id><type type="str">similar</type></item></related><status type="str">test</status><description type="str">Detects uncommon &quot;userinit.exe&quot; child processes, which could be a sign of uncommon shells or login scripts used for persistence.</description><references type="list"><item type="str">https://cocomelonc.github.io/persistence/2022/12/09/malware-pers-20.html</item><item type="str">https://learn.microsoft.com/en-us/windows-server/administration/server-core/server-core-sconfig#powershell-is-the-default-shell-on-server-core</item></references><author type="str">Tom Ueltschi (@c_APT_ure), Tim Shelton</author><date type="str">2019/01/12</date><modified type="str">2023/06/21</modified><tags type="list"><item type="str">attack.t1037.001</item><item type="str">attack.persistence</item></tags><logsource type="dict"><category type="str">process_creation</category><product type="str">windows</product></logsource><detection type="dict"><selection type="dict"><key name="ParentImage|endswith" type="str">\userinit.exe</key></selection><filter_main_explorer type="dict"><Image type="str">C:\WINDOWS\explorer.exe</Image></filter_main_explorer><filter_optional_logonscripts type="dict"><key name="CommandLine|contains" type="list"><item type="str">netlogon.bat</item><item type="str">UsrLogon.cmd</item></key></filter_optional_logonscripts><filter_optional_windows_core type="dict"><CommandLine type="str">PowerShell.exe</CommandLine></filter_optional_windows_core><filter_optional_proquota type="dict"><Image type="list"><item type="str">C:\Windows\System32\proquota.exe</item><item type="str">C:\Windows\SysWOW64\proquota.exe</item></Image></filter_optional_proquota><filter_optional_citrix type="dict"><key name="Image|endswith" type="str">\Citrix\System32\icast.exe</key></filter_optional_citrix><filter_optional_image_null type="dict"><Image type="null"></Image></filter_optional_image_null><condition type="str">selection and not 1 of filter_main_* and not 1 of filter_optional_*</condition></detection><falsepositives type="list"><item type="str">Legitimate logon scripts or custom shells may trigger false positives. Apply additional filters accordingly.</item></falsepositives><level type="str">high</level></root>