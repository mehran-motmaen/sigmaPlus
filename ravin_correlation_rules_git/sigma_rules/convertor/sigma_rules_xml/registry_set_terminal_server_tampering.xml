<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">RDP Sensitive Settings Changed</title><id type="str">3f6b7b62-61aa-45db-96bd-9c31b36b653c</id><related type="list"><item type="dict"><id type="str">171b67e1-74b4-460e-8d55-b331f3e32d67</id><type type="str">obsoletes</type></item><item type="dict"><id type="str">41904ebe-d56c-4904-b9ad-7a77bdf154b3</id><type type="str">obsoletes</type></item><item type="dict"><id type="str">a2863fbc-d5cb-48d5-83fb-d976d4b1743b</id><type type="str">similar</type></item></related><status type="str">test</status><description type="str">Detects tampering of RDP Terminal Service/Server sensitive settings.
Such as allowing unauthorized users access to a system via the &apos;fAllowUnsolicited&apos; or enabling RDP via &apos;fDenyTSConnections&apos;...etc
</description><references type="list"><item type="str">https://blog.menasec.net/2019/02/threat-hunting-rdp-hijacking-via.html</item><item type="str">http://woshub.com/rds-shadow-how-to-connect-to-a-user-session-in-windows-server-2012-r2/</item><item type="str">https://twitter.com/SagieSec/status/1469001618863624194?t=HRf0eA0W1YYzkTSHb-Ky1A&amp;s=03</item><item type="str">https://threathunterplaybook.com/hunts/windows/190407-RegModEnableRDPConnections/notebook.html</item><item type="str">https://bazaar.abuse.ch/sample/6f3aa9362d72e806490a8abce245331030d1ab5ac77e400dd475748236a6cc81/</item><item type="str">http://etutorials.org/Microsoft+Products/microsoft+windows+server+2003+terminal+services/Chapter+6+Registry/Registry+Keys+for+Terminal+Services/</item><item type="str">https://admx.help/HKLM/SOFTWARE/Policies/Microsoft/Windows%20NT/Terminal%20Services</item></references><author type="str">Samir Bousseaden, David ANDRE, Roberto Rodriguez @Cyb3rWard0g, Nasreddine Bencherchali</author><date type="str">2022/08/06</date><modified type="str">2022/09/29</modified><tags type="list"><item type="str">attack.defense_evasion</item><item type="str">attack.persistence</item><item type="str">attack.t1112</item></tags><logsource type="dict"><category type="str">registry_set</category><product type="str">windows</product></logsource><detection type="dict"><selection_shadow type="dict"><EventType type="str">SetValue</EventType><key name="TargetObject|contains" type="list"><item type="str">SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\</item><item type="str">\Control\Terminal Server\</item></key><key name="TargetObject|endswith" type="str">\Shadow</key><Details type="list"><item type="str">DWORD (0x00000001)</item><item type="str">DWORD (0x00000002)</item><item type="str">DWORD (0x00000003)</item><item type="str">DWORD (0x00000004)</item></Details></selection_shadow><selection_terminal_services_key type="dict"><EventType type="str">SetValue</EventType><key name="TargetObject|contains" type="list"><item type="str">\Control\Terminal Server\</item><item type="str">SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\</item></key></selection_terminal_services_key><selection_terminal_services_values type="dict"><key name="TargetObject|endswith" type="list"><item type="str">\fAllowUnsolicited</item><item type="str">\fAllowUnsolicitedFullControl</item></key><Details type="str">DWORD (0x00000001)</Details></selection_terminal_services_values><selection_tamper_only type="dict"><EventType type="str">SetValue</EventType><key name="TargetObject|contains" type="list"><item type="str">\services\TermService\Parameters\ServiceDll</item><item type="str">\Control\Terminal Server\WinStations\RDP-Tcp\InitialProgram</item><item type="str">\Control\Terminal Server\InitialProgram</item><item type="str">SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\InitialProgram</item></key></selection_tamper_only><condition type="str">selection_shadow or (selection_terminal_services_key and selection_terminal_services_values) or selection_tamper_only</condition></detection><falsepositives type="list"><item type="str">Some of the keys mentioned here could be modified by an administrator while setting group policy (it should be investigated either way)</item></falsepositives><level type="str">high</level></root>