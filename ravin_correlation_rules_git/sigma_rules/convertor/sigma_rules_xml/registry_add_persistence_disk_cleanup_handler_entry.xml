<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Potential Persistence Via Disk Cleanup Handler - Registry</title><id type="str">d4f4e0be-cf12-439f-9e25-4e2cdcf7df5a</id><status type="str">experimental</status><description type="str">Detects when an attacker modifies values of the Disk Cleanup Handler in the registry to achieve persistence.
The disk cleanup manager is part of the operating system. It displays the dialog box [â€¦]
The user has the option of enabling or disabling individual handlers by selecting or clearing their check box in the disk cleanup manager&apos;s UI.
Although Windows comes with a number of disk cleanup handlers, they aren&apos;t designed to handle files produced by other applications.
Instead, the disk cleanup manager is designed to be flexible and extensible by enabling any developer to implement and register their own disk cleanup handler.
Any developer can extend the available disk cleanup services by implementing and registering a disk cleanup handler.
</description><references type="list"><item type="str">https://persistence-info.github.io/Data/diskcleanuphandler.html</item><item type="str">https://www.hexacorn.com/blog/2018/09/02/beyond-good-ol-run-key-part-86/</item></references><author type="str">Nasreddine Bencherchali (Nextron Systems)</author><date type="str">2022/07/21</date><modified type="str">2023/02/07</modified><tags type="list"><item type="str">attack.persistence</item></tags><logsource type="dict"><product type="str">windows</product><category type="str">registry_add</category></logsource><detection type="dict"><selection type="dict"><EventType type="str">CreateKey</EventType><key name="TargetObject|contains" type="str">\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VolumeCaches\</key></selection><filter type="dict"><key name="TargetObject|endswith" type="list"><item type="str">\Active Setup Temp Folders</item><item type="str">\BranchCache</item><item type="str">\Content Indexer Cleaner</item><item type="str">\D3D Shader Cache</item><item type="str">\Delivery Optimization Files</item><item type="str">\Device Driver Packages</item><item type="str">\Diagnostic Data Viewer database files</item><item type="str">\Downloaded Program Files</item><item type="str">\DownloadsFolder</item><item type="str">\Feedback Hub Archive log files</item><item type="str">\Internet Cache Files</item><item type="str">\Language Pack</item><item type="str">\Microsoft Office Temp Files</item><item type="str">\Offline Pages Files</item><item type="str">\Old ChkDsk Files</item><item type="str">\Previous Installations</item><item type="str">\Recycle Bin</item><item type="str">\RetailDemo Offline Content</item><item type="str">\Setup Log Files</item><item type="str">\System error memory dump files</item><item type="str">\System error minidump files</item><item type="str">\Temporary Files</item><item type="str">\Temporary Setup Files</item><item type="str">\Temporary Sync Files</item><item type="str">\Thumbnail Cache</item><item type="str">\Update Cleanup</item><item type="str">\Upgrade Discarded Files</item><item type="str">\User file versions</item><item type="str">\Windows Defender</item><item type="str">\Windows Error Reporting Files</item><item type="str">\Windows ESD installation files</item><item type="str">\Windows Upgrade Log Files</item></key></filter><condition type="str">selection and not filter</condition></detection><falsepositives type="list"><item type="str">Legitimate new entry added by windows</item></falsepositives><level type="str">medium</level></root>