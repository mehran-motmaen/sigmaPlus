<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Potential Persistence Via COM Search Order Hijacking</title><id type="str">a0ff33d8-79e4-4cef-b4f3-9dc4133ccd12</id><status type="str">experimental</status><description type="str">Detects potential COM object hijacking leveraging the COM Search Order</description><references type="list"><item type="str">https://www.cyberbit.com/blog/endpoint-security/com-hijacking-windows-overlooked-security-vulnerability/</item></references><author type="str">Maxime Thiebaut (@0xThiebaut), oscd.community, CÃ©dric Hien</author><date type="str">2020/04/14</date><modified type="str">2023/01/10</modified><tags type="list"><item type="str">attack.persistence</item><item type="str">attack.t1546.015</item></tags><logsource type="dict"><category type="str">registry_set</category><product type="str">windows</product></logsource><detection type="dict"><selection type="dict"><EventType type="str">SetValue</EventType><key name="TargetObject|startswith" type="list"><item type="str">HKCR\CLSID\</item><item type="str">HKCU\Software\Classes\CLSID\</item></key><key name="TargetObject|endswith" type="str">\InprocServer32\(Default)</key></selection><filter_generic type="dict"><key name="Details|contains" type="list"><item type="str">%%systemroot%%\system32\</item><item type="str">%%systemroot%%\SysWow64\</item></key></filter_generic><filter_onedrive type="dict"><key name="Details|contains" type="list"><item type="str">\AppData\Local\Microsoft\OneDrive\</item><item type="str">\FileCoAuthLib64.dll</item><item type="str">\FileSyncShell64.dll</item><item type="str">\FileSyncApi64.dll</item></key></filter_onedrive><filter_health_service type="dict"><Image type="str">C:\WINDOWS\system32\SecurityHealthService.exe</Image></filter_health_service><filter_teams type="dict"><key name="Details|contains|all" type="list"><item type="str">\AppData\Local\Microsoft\TeamsMeetingAddin\</item><item type="str">\Microsoft.Teams.AddinLoader.dll</item></key></filter_teams><filter_dropbox type="dict"><key name="Details|contains|all" type="list"><item type="str">\AppData\Roaming\Dropbox\</item><item type="str">\DropboxExt64.*.dll</item></key></filter_dropbox><filter_trend_micro type="dict"><key name="Details|endswith" type="str">TmopIEPlg.dll</key></filter_trend_micro><filter_update type="dict"><Image type="list"><item type="str">C:\WINDOWS\system32\wuauclt.exe</item><item type="str">C:\WINDOWS\system32\svchost.exe</item></Image></filter_update><filter_defender type="dict"><key name="Image|startswith" type="list"><item type="str">C:\ProgramData\Microsoft\Windows Defender\Platform\</item><item type="str">C:\Program Files\Windows Defender\</item></key><key name="Image|endswith" type="str">\MsMpEng.exe</key></filter_defender><filter_nvidia type="dict"><key name="Details|contains" type="str">\FileRepository\nvmdi.inf</key></filter_nvidia><filter_edge type="dict"><key name="Image|endswith" type="str">\MicrosoftEdgeUpdateComRegisterShell64.exe</key></filter_edge><filter_dx type="dict"><Image type="str">C:\WINDOWS\SYSTEM32\dxdiag.exe</Image></filter_dx><filter_python type="dict"><Details type="list"><item type="str">C:\Windows\pyshellext.amd64.dll</item><item type="str">C:\Windows\pyshellext.dll</item></Details></filter_python><filter_bonjourlib type="dict"><Details type="list"><item type="str">C:\Windows\system32\dnssdX.dll</item><item type="str">C:\Windows\SysWOW64\dnssdX.dll</item></Details></filter_bonjourlib><filter_printextensionmanager type="dict"><Details type="str">C:\Windows\system32\spool\drivers\x64\3\PrintConfig.dll</Details></filter_printextensionmanager><filter_programfiles type="dict"><key name="Details|startswith" type="list"><item type="str">C:\Program Files\</item><item type="str">C:\Program Files (x86)\</item></key></filter_programfiles><filter_programdata type="dict"><key name="Details|startswith" type="str">C:\ProgramData\Microsoft\</key></filter_programdata><filter_gameservice type="dict"><key name="Details|contains" type="str">C:\WINDOWS\system32\GamingServicesProxy.dll</key></filter_gameservice><filter_poqexec type="dict"><Image type="str">C:\Windows\System32\poqexec.exe</Image><key name="Details|contains" type="str">C:\Windows\System32\Autopilot.dll</key></filter_poqexec><filter_sec_health_svc type="dict"><Image type="str">C:\Windows\system32\SecurityHealthService.exe</Image><key name="Details|contains" type="str">C:\Windows\System32\SecurityHealth</key></filter_sec_health_svc><filter_inprocserver type="dict"><Image type="list"><item type="str">C:\Windows\System32\poqexec.exe</item><item type="str">C:\Windows\System32\regsvr32.exe</item></Image><key name="TargetObject|endswith" type="str">\InProcServer32\(Default)</key></filter_inprocserver><condition type="str">selection and not 1 of filter_*</condition></detection><falsepositives type="list"><item type="str">Some installed utilities (i.e. OneDrive) may serve new COM objects at user-level</item></falsepositives><level type="str">medium</level></root>