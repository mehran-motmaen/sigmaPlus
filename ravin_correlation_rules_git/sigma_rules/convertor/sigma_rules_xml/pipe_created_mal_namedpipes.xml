<?xml version="1.0" encoding="UTF-8" ?><root><title type="str">Malicious Named Pipe</title><id type="str">fe3ac066-98bb-432a-b1e7-a5229cb39d4a</id><status type="str">test</status><description type="str">Detects the creation of a named pipe used by known APT malware</description><references type="list"><item type="str">https://securelist.com/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/71275/</item><item type="str">https://securelist.com/faq-the-projectsauron-apt/75533/</item><item type="str">https://web.archive.org/web/20180725233601/https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf</item><item type="str">https://www.us-cert.gov/ncas/alerts/TA17-117A</item><item type="str">https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html</item><item type="str">https://thedfirreport.com/2020/06/21/snatch-ransomware/</item><item type="str">https://github.com/RiccardoAncarani/LiquidSnake</item><item type="str">https://www.accenture.com/us-en/blogs/cyber-defense/turla-belugasturgeon-compromises-government-entity</item><item type="str">https://us-cert.cisa.gov/ncas/analysis-reports/ar19-304a</item><item type="str">https://download.bitdefender.com/resources/files/News/CaseStudies/study/115/Bitdefender-Whitepaper-PAC-A4-en-EN1.pdf</item><item type="str">https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/</item><item type="str">https://thedfirreport.com/2022/02/21/qbot-and-zerologon-lead-to-full-domain-compromise/</item></references><author type="str">Florian Roth (Nextron Systems), blueteam0ps, elhoim</author><date type="str">2017/11/06</date><modified type="str">2022/03/15</modified><tags type="list"><item type="str">attack.defense_evasion</item><item type="str">attack.privilege_escalation</item><item type="str">attack.t1055</item></tags><logsource type="dict"><product type="str">windows</product><category type="str">pipe_created</category><definition type="str">Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575</definition></logsource><detection type="dict"><selection type="dict"><PipeName type="list"><item type="str">\isapi_http</item><item type="str">\isapi_dg</item><item type="str">\isapi_dg2</item><item type="str">\sdlrpc</item><item type="str">\ahexec</item><item type="str">\winsession</item><item type="str">\lsassw</item><item type="str">\46a676ab7f179e511e30dd2dc41bd388</item><item type="str">\9f81f59bc58452127884ce513865ed20</item><item type="str">\e710f28d59aa529d6792ca6ff0ca1b34</item><item type="str">\rpchlp_3</item><item type="str">\NamePipe_MoreWindows</item><item type="str">\pcheap_reuse</item><item type="str">\gruntsvc</item><item type="str">\583da945-62af-10e8-4902-a8f205c72b2e</item><item type="str">\bizkaz</item><item type="str">\svcctl</item><item type="str">\Posh*</item><item type="str">\jaccdpqnvbrrxlaf</item><item type="str">\csexecsvc</item><item type="str">\6e7645c4-32c5-4fe3-aabf-e94c2f4370e7</item><item type="str">\adschemerpc</item><item type="str">\AnonymousPipe</item><item type="str">\bc367</item><item type="str">\bc31a7</item><item type="str">\testPipe</item><item type="str">\dce_3d</item></PipeName></selection><condition type="str">selection</condition></detection><falsepositives type="list"><item type="str">Unknown</item></falsepositives><level type="str">critical</level></root>