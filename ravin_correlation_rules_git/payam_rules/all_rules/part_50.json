{
  "rule": {
    "@id": "3502",
    "@owner": "system",
    "@enable": "f",
    "@kbid": "3502_1",
    "@ver": "1",
    "@file_name": "",
    "filter_list": {
      "filter": [
        {
          "@id": "1",
          "@name": "Botnet DNS query to DNS server detected",
          "@weight": "5",
          "source": {
            "ip": {
              "@location": "ANY"
            },
            "port": "0-65535"
          },
          "target": {
            "ip": {
              "@location": "ANY"
            },
            "port": "53"
          },
          "event_list": {
            "event": [
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": [
                  {
                    "@meaning": "mechanism",
                    "#text": "Botnet"
                  },
                  {
                    "@meaning": "mechanism_detail",
                    "#text": "Domain Request"
                  }
                ]
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": [
                  {
                    "@meaning": "mechanism",
                    "#text": "Botnet"
                  },
                  {
                    "@meaning": "mechanism_detail",
                    "#text": "DGA"
                  }
                ]
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": {
                  "@meaning": "mechanism_detail",
                  "#text": "Sinkhole"
                }
              }
            ]
          }
        },
        {
          "@id": "2",
          "@name": "Suspicious domain lookup responses from DNS server to client",
          "@occurrence": "1",
          "@weight": "10",
          "@timeout": "1800",
          "source": {
            "ip": {
              "@location": "ANY"
            },
            "port": "53"
          },
          "target": {
            "ip": {
              "@reference_id": "1",
              "@reference_type": "source"
            },
            "port": "0-65535"
          },
          "event_list": {
            "event": [
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": {
                  "@meaning": "mechanism",
                  "#text": "Suspicious Domain Lookup"
                }
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": {
                  "@meaning": "mechanism_detail",
                  "#text": "Sinkhole"
                }
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": [
                  {
                    "@meaning": "mechanism",
                    "#text": "Botnet"
                  },
                  {
                    "@meaning": "mechanism_detail",
                    "#text": "Domain Request"
                  }
                ]
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": [
                  {
                    "@meaning": "mechanism",
                    "#text": "Botnet"
                  },
                  {
                    "@meaning": "mechanism_detail",
                    "#text": "DGA"
                  }
                ]
              }
            ]
          }
        },
        {
          "@id": "3",
          "@name": "Botnet DNS query to DNS server Detected",
          "@occurrence": "10",
          "@weight": "10",
          "@timeout": "1800",
          "source": {
            "ip": {
              "@reference_id": "1",
              "@reference_type": "source"
            },
            "port": "0-65535"
          },
          "target": {
            "ip": {
              "@location": "ANY"
            },
            "port": "53"
          },
          "flag_list": {
            "flag": "sticky"
          },
          "event_list": {
            "event": [
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": [
                  {
                    "@meaning": "mechanism",
                    "#text": "Botnet"
                  },
                  {
                    "@meaning": "mechanism_detail",
                    "#text": "Domain Request"
                  }
                ]
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": [
                  {
                    "@meaning": "mechanism",
                    "#text": "Botnet"
                  },
                  {
                    "@meaning": "mechanism_detail",
                    "#text": "DGA"
                  }
                ]
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": {
                  "@meaning": "mechanism_detail",
                  "#text": "Sinkhole"
                }
              }
            ]
          }
        },
        {
          "@id": "4",
          "@name": "Botnet DNS query to DNS server detected",
          "@occurrence": "1000",
          "@weight": "1",
          "@timeout": "9600",
          "source": {
            "ip": {
              "@reference_id": "1",
              "@reference_type": "source"
            },
            "port": "0-65535"
          },
          "target": {
            "ip": {
              "@location": "ANY"
            },
            "port": "53"
          },
          "flag_list": {
            "flag": "sticky"
          },
          "event_list": {
            "event": [
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": [
                  {
                    "@meaning": "mechanism",
                    "#text": "Botnet"
                  },
                  {
                    "@meaning": "mechanism_detail",
                    "#text": "Domain Request"
                  }
                ]
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": [
                  {
                    "@meaning": "mechanism",
                    "#text": "Botnet"
                  },
                  {
                    "@meaning": "mechanism_detail",
                    "#text": "DGA"
                  }
                ]
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": {
                  "@meaning": "mechanism_detail",
                  "#text": "Sinkhole"
                }
              }
            ]
          }
        },
        {
          "@id": "5",
          "@name": "Suspicious DNS responses to potentially malicious hosts detected",
          "@occurrence": "100",
          "@weight": "1",
          "@timeout": "9600",
          "source": {
            "ip": {
              "@reference_id": "1",
              "@reference_type": "target"
            },
            "port": "0-65535"
          },
          "target": {
            "ip": {
              "@location": "ANY"
            },
            "port": "0-65535"
          },
          "flag_list": {
            "flag": "sticky"
          },
          "event_list": {
            "event": [
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": {
                  "@meaning": "mechanism",
                  "#text": "Suspicious Domain Lookup"
                }
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": {
                  "@meaning": "mechanism_detail",
                  "#text": "Sinkhole"
                }
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": [
                  {
                    "@meaning": "mechanism",
                    "#text": "Botnet"
                  },
                  {
                    "@meaning": "mechanism_detail",
                    "#text": "Domain Request"
                  }
                ]
              },
              {
                "@sensor_type": "ANY",
                "@class_type": "",
                "tag": [
                  {
                    "@meaning": "mechanism",
                    "#text": "Botnet"
                  },
                  {
                    "@meaning": "mechanism_detail",
                    "#text": "DGA"
                  }
                ]
              }
            ]
          },
          "diversity": {
            "param": {
              "@reference_type": "target.ip"
            }
          }
        }
      ]
    },
    "action": {
      "alert": {
        "@priority": "medium",
        "@category": "Botnet",
        "message": "Malware related DNS query request/responses",
        "source": {
          "ip": [
            {
              "@reference_id": "1",
              "@reference_type": "source"
            },
            {
              "@reference_id": "5",
              "@reference_type": "target"
            }
          ]
        },
        "target": {
          "ip": [
            {
              "@reference_id": "1",
              "@reference_type": "target"
            },
            {
              "@reference_id": "2",
              "@reference_type": "source"
            },
            {
              "@reference_id": "3",
              "@reference_type": "target"
            },
            {
              "@reference_id": "4",
              "@reference_type": "target"
            }
          ]
        },
        "additional_data": [
          {
            "@meaning": "MalwareName",
            "@reference_id": "1"
          },
          {
            "@meaning": "MalwareName",
            "@reference_id": "2"
          },
          {
            "@meaning": "MalwareName",
            "@reference_id": "3"
          },
          {
            "@meaning": "MalwareName",
            "@reference_id": "4"
          },
          {
            "@meaning": "MalwareName",
            "@reference_id": "5"
          },
          {
            "@meaning": "URL",
            "@reference_id": "1"
          },
          {
            "@meaning": "URL",
            "@reference_id": "2"
          },
          {
            "@meaning": "URL",
            "@reference_id": "3"
          },
          {
            "@meaning": "URL",
            "@reference_id": "4"
          },
          {
            "@meaning": "URL",
            "@reference_id": "5"
          },
          {
            "@meaning": "DomainName",
            "@reference_id": "1"
          },
          {
            "@meaning": "DomainName",
            "@reference_id": "2"
          },
          {
            "@meaning": "DomainName",
            "@reference_id": "3"
          },
          {
            "@meaning": "DomainName",
            "@reference_id": "4"
          },
          {
            "@meaning": "DomainName",
            "@reference_id": "5"
          }
        ]
      },
      "prerequisite": {
        "predicate": [
          {
            "@type": "BotSpot-Host",
            "param": {
              "@reference_type": "source.ip"
            }
          },
          {
            "@type": "Hopping",
            "param": {
              "@reference_type": "source.ip"
            }
          }
        ]
      },
      "consequence": {
        "predicate": [
          {
            "@type": "Infection-Malicious",
            "param": {
              "@reference_type": "source.ip"
            }
          },
          {
            "@type": "BotSpot-Host",
            "@timeout": "3600",
            "param": {
              "@reference_type": "source.ip"
            }
          },
          {
            "@type": "CnC-Server",
            "@timeout": "3600",
            "param": {
              "@reference_type": "target.ip"
            }
          },
          {
            "@type": "Hopping",
            "@timeout": "43200",
            "param": {
              "@reference_type": "target.ip"
            }
          }
        ]
      }
    },
    "regulation": {
      "sequence": {
        "filter": {
          "@id": "1"
        },
        "group": [
          {
            "filter": [
              {
                "@id": "2"
              },
              {
                "@id": "3"
              }
            ]
          },
          {
            "filter": [
              {
                "@id": "4"
              },
              {
                "@id": "5"
              }
            ]
          }
        ]
      }
    }
  }
}